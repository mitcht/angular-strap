{"version":3,"sources":["modules/compiler.js"],"names":["templateUrl","options","cache","$templateCache","then","element","res","fetchTemplate","template","fetchPromises","$http","get","bsCompilerService","data","this","compile","controller","console","controllerAs","resolve","copy","locals","bindToController","angular","forEach","value","isString","$injector","key","invoke","transformTemplate","identity","extend","$template","when","$q","contentEl","findElement","outerHTML","contentTemplate","all","templateEl","removeAttr","html","templates","replace","next","remove","link","scope","trim","contents","linkFn","invokeCtrl","children","instance","ctrl","isObject","arguments","apply","service","$inject"],"mappings":"AAOA,YAIA,SAmEQA,mBAAcC,EAAQD,EAAAA,EAAAA,EAAAA,EAAAA,GAF5B,QA4FyDE,GAAOC,EAAAA,GA3F9D,MA4FGC,SAAKC,SAASC,GAAAA,UAAAA,iBAAAA,IAzFnB,QAASC,GAAcC,GACrB,MAAIC,GAAcD,GAAkBC,EAAcD,GAC3CC,EAAcD,GAAYE,EAAMC,IAAIH,GA6F/CI,MAAAA,IA3FOR,KAAK,SAASE,GACf,MAAOA,GAAIO,OAzEfC,KAmEEC,QAAIP,SAAWP,GACXe,EAAAA,UAAaf,UAAQe,KAAAA,EAAAA,YACzBC,QAAIC,KAAAA,oGACJjB,EAAIkB,YAAkBC,EAAKnB,SAC3BA,EAAIoB,SAAiBD,GAErB,IAAIE,GAAAA,EAAmBrB,YAKvBsB,EAAQC,EAAQL,UAAkBM,GAChCT,EAAYU,EAASD,WACnBN,EAAeQ,EAAAA,aAtEfR,EAuEKI,QAAAH,KAAAnB,EAAAkB,aACLA,EAAQS,QAAOD,KAAAA,EAAUE,YAtEzBC,EAAoB7B,EAAQ6B,mBAAqBP,QAAQQ,SACzDT,EAAmBrB,EAAQqB,gBAsB/B,OAoDAC,SAAQS,QAAOb,EAASE,SAAAA,EAAAA,GAGtBF,EAAQc,GADNjC,QAAAA,SAAayB,GACPQ,EAAY1B,IAAAA,GAEZ0B,EAAeC,OAAK1B,KAvE9Be,QA4EEJ,OAAQc,EAAYE,GA1EpBhB,EA6EQiB,UADJpC,EACgBqC,EAAYrC,GAGVmC,EAAGG,KAAAA,GA5EvBrC,EAAQsC,kBAiFZpB,EAAUqB,UAAIrB,EAASf,KAAKe,EAASE,UAAAA,EAAAA,EAAAA,mBAAAA,KAAAA,SAAAA,GAEnC,GAAIb,GAAWsB,QAAAA,QAAkBT,EAAOY,IACpChC,EAAcoC,EAAA,sBAAAI,EAAA,IAAAC,WAAA,WAAAC,KAAAC,EAAA,GA/EhB,OAgFApC,GAAWA,aAASqC,EAAQC,OAAeC,SAhFpCN,EAAW,GAAGH,aAuFvBH,EAAAK,IAAArB,GAAAf,KAAA,SAAAiB,GAnFA,GAoFEA,GAAQA,EAAAA,EAAAA,UACRhB,GAASA,OACT2C,EAAMxC,EAAcyC,QAAAA,cAAAA,kBAlFtB,IAsFI5C,GAAIW,QAAYX,QAAA,SAAAsC,KAAAnC,EAAA0C,QAAAC,WArFhBC,EAsFMC,EAAAA,EArFV,QACEhC,OAsFME,EArFNlB,QAASA,EACT2C,KAuFI,SAAWzB,GArFb,GADAF,EAwFEhB,OAAa4C,EACb5C,EAAQiD,CAER,GAAIpC,GAAAA,EAAcF,EAAAK,GAAA,EAChB4B,IAxFA1B,QAAQS,OAAOqB,EAAWE,SAAUlC,EA4FxC,IAAAmC,GAAOJ,QAAaK,SAAMC,GAAAA,EAAAA,GAzFxBrD,GAAQQ,KAAK,0BAA2B2C,GACxCnD,EAAQiD,WAAWzC,KAAK,0BAA2B2C,GAC/CtC,IACF+B,EAAM/B,GAAgBsC,GAG1B,MAAOJ,GAAOO,MAAM,KAAMD,eAQlC,IAAIjD,MAtENc,QAkEMtB,OAAQO,0BAAWoD,QAAA,cAAAhD,mBAezBA,kBAAkBiD,SAAY,KAAM,QAAS,YAAa,WAAY,cAAe","file":"modules/compiler.min.js","sourcesContent":["'use strict';\r\n\r\n// NOTICE: This file was forked from the angular-material project (github.com/angular/material)\r\n// MIT Licensed - Copyright (c) 2014-2015 Google, Inc. http://angularjs.org\r\n\r\nangular.module('mgcrea.ngStrap.core', [])\r\n  .service('$bsCompiler', bsCompilerService);\r\n\r\nfunction bsCompilerService($q, $http, $injector, $compile, $controller, $templateCache) {\r\n  /* jshint validthis: true */\r\n\r\n  /*\r\n   * @ngdoc service\r\n   * @name $bsCompiler\r\n   * @module material.core\r\n   * @description\r\n   * The $bsCompiler service is an abstraction of angular's compiler, that allows the developer\r\n   * to easily compile an element with a templateUrl, controller, and locals.\r\n   *\r\n   * @usage\r\n   * <hljs lang=\"js\">\r\n   * $bsCompiler.compile({\r\n   *   templateUrl: 'modal.html',\r\n   *   controller: 'ModalCtrl',\r\n   *   locals: {\r\n   *     modal: myModalInstance;\r\n   *   }\r\n   * }).then(function(compileData) {\r\n   *   compileData.element; // modal.html's template in an element\r\n   *   compileData.link(myScope); //attach controller & scope to element\r\n   * });\r\n   * </hljs>\r\n   */\r\n\r\n   /*\r\n    * @ngdoc method\r\n    * @name $bsCompiler#compile\r\n    * @description A helper to compile an HTML template/templateUrl with a given controller,\r\n    * locals, and scope.\r\n    * @param {object} options An options object, with the following properties:\r\n    *\r\n    *    - `controller` - `{(string=|function()=}` Controller fn that should be associated with\r\n    *      newly created scope or the name of a registered controller if passed as a string.\r\n    *    - `controllerAs` - `{string=}` A controller alias name. If present the controller will be\r\n    *      published to scope under the `controllerAs` name.\r\n    *    - `template` - `{string=}` An html template as a string.\r\n    *    - `templateUrl` - `{string=}` A path to an html template.\r\n    *    - `transformTemplate` - `{function(template)=}` A function which transforms the template after\r\n    *      it is loaded. It will be given the template string as a parameter, and should\r\n    *      return a a new string representing the transformed template.\r\n    *    - `resolve` - `{Object.<string, function>=}` - An optional map of dependencies which should\r\n    *      be injected into the controller. If any of these dependencies are promises, the compiler\r\n    *      will wait for them all to be resolved, or if one is rejected before the controller is\r\n    *      instantiated `compile()` will fail..\r\n    *      * `key` - `{string}`: a name of a dependency to be injected into the controller.\r\n    *      * `factory` - `{string|function}`: If `string` then it is an alias for a service.\r\n    *        Otherwise if function, then it is injected and the return value is treated as the\r\n    *        dependency. If the result is a promise, it is resolved before its value is\r\n    *        injected into the controller.\r\n    *\r\n    * @returns {object=} promise A promise, which will be resolved with a `compileData` object.\r\n    * `compileData` has the following properties:\r\n    *\r\n    *   - `element` - `{element}`: an uncompiled element matching the provided template.\r\n    *   - `link` - `{function(scope)}`: A link function, which, when called, will compile\r\n    *     the element and instantiate the provided controller (if given).\r\n    *   - `locals` - `{object}`: The locals which will be passed into the controller once `link` is\r\n    *     called. If `bindToController` is true, they will be coppied to the ctrl instead\r\n    *   - `bindToController` - `bool`: bind the locals to the controller, instead of passing them in.\r\n    */\r\n  this.compile = function(options) {\r\n\r\n    if(options.template && /\\.html$/.test(options.template)) {\r\n      console.warn('Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead.');\r\n      options.templateUrl = options.template;\r\n      options.template = '';\r\n    }\r\n\r\n    var templateUrl = options.templateUrl;\r\n    var template = options.template || '';\r\n    var controller = options.controller;\r\n    var controllerAs = options.controllerAs;\r\n    var resolve = angular.copy(options.resolve || {});\r\n    var locals = angular.copy(options.locals || {});\r\n    var transformTemplate = options.transformTemplate || angular.identity;\r\n    var bindToController = options.bindToController;\r\n\r\n    // Take resolve values and invoke them.\r\n    // Resolves can either be a string (value: 'MyRegisteredAngularConst'),\r\n    // or an invokable 'factory' of sorts: (value: function ValueGetter($dependency) {})\r\n    angular.forEach(resolve, function(value, key) {\r\n      if (angular.isString(value)) {\r\n        resolve[key] = $injector.get(value);\r\n      } else {\r\n        resolve[key] = $injector.invoke(value);\r\n      }\r\n    });\r\n    // Add the locals, which are just straight values to inject\r\n    // eg locals: { three: 3 }, will inject three into the controller\r\n    angular.extend(resolve, locals);\r\n\r\n    if (templateUrl) {\r\n      resolve.$template = fetchTemplate(templateUrl);\r\n    } else {\r\n      resolve.$template = $q.when(template);\r\n    }\r\n\r\n    if (options.contentTemplate) {\r\n      // TODO(mgcrea): deprecate?\r\n      resolve.$template = $q.all([resolve.$template, fetchTemplate(options.contentTemplate)])\r\n        .then(function(templates) {\r\n          var templateEl = angular.element(templates[0]);\r\n          var contentEl = findElement('[ng-bind=\"content\"]', templateEl[0]).removeAttr('ng-bind').html(templates[1]);\r\n          // Drop the default footer as you probably don't want it if you use a custom contentTemplate\r\n          if(!options.templateUrl) contentEl.next().remove();\r\n          return templateEl[0].outerHTML;\r\n        });\r\n    }\r\n\r\n    // Wait for all the resolves to finish if they are promises\r\n    return $q.all(resolve).then(function(locals) {\r\n\r\n      var template = transformTemplate(locals.$template);\r\n      if (options.html) {\r\n        template = template.replace(/ng-bind=\"/ig, 'ng-bind-html=\"');\r\n      }\r\n      // var element = options.element || angular.element('<div>').html(template.trim()).contents();\r\n      var element = angular.element('<div>').html(template.trim()).contents();\r\n      var linkFn = $compile(element);\r\n\r\n      // Return a linking function that can be used later when the element is ready\r\n      return {\r\n        locals: locals,\r\n        element: element,\r\n        link: function link(scope) {\r\n          locals.$scope = scope;\r\n\r\n          // Instantiate controller if it exists, because we have scope\r\n          if (controller) {\r\n            var invokeCtrl = $controller(controller, locals, true);\r\n            if (bindToController) {\r\n              angular.extend(invokeCtrl.instance, locals);\r\n            }\r\n            // Support angular@~1.2 invokeCtrl\r\n            var ctrl = angular.isObject(invokeCtrl) ? invokeCtrl : invokeCtrl();\r\n            // See angular-route source for this logic\r\n            element.data('$ngControllerController', ctrl);\r\n            element.children().data('$ngControllerController', ctrl);\r\n\r\n            if (controllerAs) {\r\n              scope[controllerAs] = ctrl;\r\n            }\r\n          }\r\n\r\n          return linkFn.apply(null, arguments);\r\n        }\r\n      };\r\n    });\r\n\r\n  };\r\n\r\n  function findElement(query, element) {\r\n    return angular.element((element || document).querySelectorAll(query));\r\n  }\r\n\r\n  var fetchPromises = {};\r\n  function fetchTemplate(template) {\r\n    if(fetchPromises[template]) return fetchPromises[template];\r\n    return (fetchPromises[template] = $http.get(template, {cache: $templateCache})\r\n      .then(function(res) {\r\n        return res.data;\r\n      }));\r\n  }\r\n\r\n}\r\n"],"sourceRoot":"/source/"}